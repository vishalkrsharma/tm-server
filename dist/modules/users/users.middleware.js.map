{"version":3,"sources":["../../../src/modules/users/users.middleware.ts"],"sourcesContent":["import { Injectable, OnModuleInit } from '@nestjs/common';\nimport { InjectModel } from '@nestjs/mongoose';\nimport { Model } from 'mongoose';\nimport { hashPassword } from 'src/common/password';\nimport { User, UserDocument } from 'src/schemas/user.schema';\n\n@Injectable()\nexport class UsersMiddleware implements OnModuleInit {\n  constructor(@InjectModel(User.name) private userModel: Model<UserDocument>) {}\n\n  async onModuleInit() {\n    this.userModel.schema.pre('save', async function (next) {\n      const user = this as UserDocument;\n\n      if (!user.isModified('password')) {\n        return next();\n      }\n\n      try {\n        user.password = await hashPassword(user.password);\n\n        next();\n      } catch (err) {\n        next(err);\n      }\n    });\n  }\n}\n"],"names":["UsersMiddleware","onModuleInit","userModel","schema","pre","next","user","isModified","password","hashPassword","err","constructor","name"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAP4B;0BACb;2BACN;0BACO;4BACM;;;;;;;;;;;;;;;AAG5B,IAAA,AAAMA,kBAAN,MAAMA;IAGX,MAAMC,eAAe;QACnB,IAAI,CAACC,SAAS,CAACC,MAAM,CAACC,GAAG,CAAC,QAAQ,eAAgBC,IAAI;YACpD,MAAMC,OAAO,IAAI;YAEjB,IAAI,CAACA,KAAKC,UAAU,CAAC,aAAa;gBAChC,OAAOF;YACT;YAEA,IAAI;gBACFC,KAAKE,QAAQ,GAAG,MAAMC,IAAAA,sBAAY,EAACH,KAAKE,QAAQ;gBAEhDH;YACF,EAAE,OAAOK,KAAK;gBACZL,KAAKK;YACP;QACF;IACF;IAlBAC,YAAY,AAAgCT,SAA8B,CAAE;aAAhCA,YAAAA;IAAiC;AAmB/E;;;6DAnBgCU"}